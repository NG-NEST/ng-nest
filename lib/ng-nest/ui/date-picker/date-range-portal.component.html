<div class="x-date-range-portal {{ type }}">
  <div class="x-date-range-portal-body" [ngSwitch]="type">
    <ng-container *ngSwitchCase="'date'">
      <x-picker-date
        #startPicker
        class="x-date-range-portal-start"
        [(display)]="startDisplay"
        [model]="startModel"
        [rangeValue]="value"
        [rangeType]="activeType"
        [nextYearBtn]="false"
        [nextMonthBtn]="false"
        (modelChange)="dateChange($event)"
        (yearChange)="yearChange($event, 'start')"
        (monthChange)="monthChange($event, 'start')"
        (rangeTdMouseenter)="setDatesState($event)"
        (rangeDateClick)="setDatesState($event)"
        rangePicker
      ></x-picker-date>
      <x-picker-date
        #endPicker
        class="x-date-range-portal-end"
        [(display)]="endDisplay"
        [model]="endModel"
        [rangeValue]="value"
        [rangeType]="activeType"
        [lastYearBtn]="false"
        [lastMonthBtn]="false"
        (modelChange)="dateChange($event)"
        (yearChange)="yearChange($event, 'end')"
        (monthChange)="monthChange($event, 'end')"
        (rangeTdMouseenter)="setDatesState($event)"
        (rangeDateClick)="setDatesState($event)"
        rangePicker
      ></x-picker-date>
    </ng-container>
    <ng-container *ngSwitchCase="'month'">
      <x-picker-month
        #startPicker
        class="x-date-range-portal-start"
        [(display)]="startDisplay"
        [model]="startModel"
        [rangeValue]="value"
        [rangeType]="activeType"
        [nextYearBtn]="false"
        (modelChange)="dateChange($event)"
        (yearChange)="yearChange($event, 'start')"
        (monthChange)="monthChange($event, 'start')"
        (rangeTdMouseenter)="setDatesState($event)"
        (rangeDateClick)="setDatesState($event)"
        rangePicker
      ></x-picker-month>
      <x-picker-month
        #endPicker
        class="x-date-range-portal-end"
        [(display)]="endDisplay"
        [model]="endModel"
        [rangeValue]="value"
        [rangeType]="activeType"
        [lastYearBtn]="false"
        (modelChange)="dateChange($event)"
        (yearChange)="yearChange($event, 'end')"
        (monthChange)="monthChange($event, 'end')"
        (rangeTdMouseenter)="setDatesState($event)"
        (rangeDateClick)="setDatesState($event)"
        rangePicker
      ></x-picker-month>
    </ng-container>
    <ng-container *ngSwitchCase="'year'">
      <x-picker-year
        #startPicker
        class="x-date-range-portal-start"
        [(display)]="startDisplay"
        [model]="startModel"
        [rangeValue]="value"
        [rangeType]="activeType"
        [nextYearBtn]="false"
        (modelChange)="dateChange($event)"
        (yearChange)="yearChange($event, 'start')"
        (monthChange)="monthChange($event, 'start')"
        (rangeTdMouseenter)="setDatesState($event)"
        (rangeDateClick)="setDatesState($event)"
        rangePicker
      ></x-picker-year>
      <x-picker-year
        #endPicker
        class="x-date-range-portal-end"
        [(display)]="endDisplay"
        [model]="endModel"
        [rangeValue]="value"
        [rangeType]="activeType"
        [lastYearBtn]="false"
        (modelChange)="dateChange($event)"
        (yearChange)="yearChange($event, 'end')"
        (monthChange)="monthChange($event, 'end')"
        (rangeTdMouseenter)="setDatesState($event)"
        (rangeDateClick)="setDatesState($event)"
        rangePicker
      ></x-picker-year>
    </ng-container>
    <ng-container *ngSwitchCase="'date-time'">
      <ng-container *ngTemplateOutlet="dateTimeHourMinuteTpl; context: { timeFormat: 'HH:mm:ss', timeType: 'time' }"></ng-container>
    </ng-container>
    <ng-container *ngSwitchCase="'date-hour'">
      <ng-container *ngTemplateOutlet="dateTimeHourMinuteTpl; context: { timeFormat: 'HH', timeType: 'hour' }"></ng-container>
    </ng-container>
    <ng-container *ngSwitchCase="'date-minute'">
      <ng-container *ngTemplateOutlet="dateTimeHourMinuteTpl; context: { timeFormat: 'HH:mm', timeType: 'minute' }"></ng-container>
    </ng-container>
  </div>
  <ng-container *ngIf="isDatePicker">
    <div *ngIf="extraFooter" class="x-date-range-portal-extra-footer">
      <ng-container *xOutlet="extraFooter">{{ extraFooter }}</ng-container>
    </div>
    <ng-container *ngTemplateOutlet="presetTpl"></ng-container>
  </ng-container>
</div>

<ng-template #dateTimeHourMinuteTpl let-timeFormat="timeFormat" let-timeType="timeType">
  <div class="x-date-range-portal-content">
    <div class="x-date-range-portal-date">
      <x-picker-date
        [class.x-date-range-portal-start]="activeType === 'start'"
        [class.x-date-range-portal-end]="activeType === 'end'"
        [(display)]="timeDisplay"
        [(model)]="timeModel"
        [rangeHover]="timeHover"
        [rangeValue]="value"
        [rangeType]="activeType"
        (modelChange)="dateChange($event)"
        rangePicker
      ></x-picker-date>
    </div>
    <div class="x-date-range-portal-time">
      <div class="x-date-range-portal-time-label">
        {{ time | date : timeFormat }}
      </div>
      <x-time-picker-frame [type]="timeType" [value]="time" (nodeEmit)="selectTime($event)" [defaultNow]="false"></x-time-picker-frame>
    </div>
  </div>
  <ng-container *ngIf="!isDatePicker">
    <div *ngIf="extraFooter" class="x-date-range-portal-extra-footer">
      <ng-container *xOutlet="extraFooter">{{ extraFooter }}</ng-container>
    </div>
  </ng-container>
  <div class="x-date-range-portal-footer">
    <div class="x-date-range-portal-footer-left">
      <ng-container *ngIf="!isDatePicker">
        <ng-container *ngTemplateOutlet="presetTpl"></ng-container>
      </ng-container>
    </div>
    <x-button type="primary" (click)="sureTime()" size="small" [disabled]="timeSureDisabled">{{ locale.sure }}</x-button>
  </div>
</ng-template>

<ng-template #presetTpl>
  <div *ngIf="preset" class="x-date-range-portal-preset">
    <ng-container *ngFor="let item of preset">
      <x-link *ngIf="item.id === 'thisWeek'" (click)="onPreset('week', 0)">{{ locale.thisWeek }}</x-link>
      <x-link *ngIf="item.id === 'lastWeek'" (click)="onPreset('week', -1)">{{ locale.lastWeek }}</x-link>
      <x-link *ngIf="item.id === 'nextWeek'" (click)="onPreset('week', 1)">{{ locale.nextWeek }}</x-link>
      <x-link *ngIf="item.id === 'thisMonth'" (click)="onPreset('month', 0)">{{ locale.thisMonth }}</x-link>
      <x-link *ngIf="item.id === 'lastMonth'" (click)="onPreset('month', -1)">{{ locale.lastMonth }}</x-link>
      <x-link *ngIf="item.id === 'nextMonth'" (click)="onPreset('month', 1)">{{ locale.nextMonth }}</x-link>
      <x-link *ngIf="item.id === 'thisYear'" (click)="onPreset('year', 0)">{{ locale.thisYear }}</x-link>
      <x-link *ngIf="item.id === 'lastYear'" (click)="onPreset('year', -1)">{{ locale.lastYear }}</x-link>
      <x-link *ngIf="item.id === 'nextYear'" (click)="onPreset('year', 1)">{{ locale.nextYear }}</x-link>
      <x-link *ngIf="item.func" (click)="onPresetFunc(item)">{{ item.label }}</x-link>
    </ng-container>
  </div>
</ng-template>
